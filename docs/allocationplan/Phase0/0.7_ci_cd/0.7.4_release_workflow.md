# Micro-Phase 0.7.4: Release Automation Workflow

## Objective
Create automated release workflow with multi-platform builds, artifact generation, and GitHub release management.

## Prerequisites
- Basic CI workflow setup (0.7.1 complete)
- Security workflows setup (0.7.3 complete)

## Input
- CI/CD infrastructure foundation
- Release build requirements
- Artifact distribution needs

## Task Details

### Step 1: Create Release Workflow
Setup automated release builds triggered by version tags.

### Step 2: Add Multi-Platform Builds
Configure builds for Linux, Windows, and macOS platforms.

### Step 3: Setup Artifact Generation
Create release artifacts with proper naming and packaging.

### Step 4: Add GitHub Release Integration
Automate GitHub release creation with artifacts and notes.

## Expected Output
- `.github/workflows/release.yml` created
- Multi-platform release builds
- Automated artifact generation
- GitHub release automation

## Verification Steps
1. Test release workflow with sample tag
2. Verify multi-platform builds work
3. Check artifact generation and upload
4. Confirm GitHub release creation

## Time Estimate
25-30 minutes

## AI Execution Prompt
```
Setup automated release workflow with multi-platform builds and GitHub integration.

1. Create .github/workflows/release.yml:

```yaml
name: Release

on:
  push:
    tags:
      - 'v*'

env:
  CARGO_TERM_COLOR: always

jobs:
  test:
    name: Test Release
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install Rust toolchain
      uses: dtolnay/rust-toolchain@stable

    - name: Run tests
      run: cargo test --release --workspace

  build:
    name: Build Release Artifacts
    runs-on: ${{ matrix.os }}
    needs: test
    strategy:
      matrix:
        include:
          - os: ubuntu-latest
            target: x86_64-unknown-linux-gnu
            artifact_name: cortesia-linux-x86_64
            binary_extension: ""
          - os: windows-latest
            target: x86_64-pc-windows-msvc
            artifact_name: cortesia-windows-x86_64
            binary_extension: ".exe"
          - os: macos-latest
            target: x86_64-apple-darwin
            artifact_name: cortesia-macos-x86_64
            binary_extension: ""
          - os: macos-latest
            target: aarch64-apple-darwin
            artifact_name: cortesia-macos-aarch64
            binary_extension: ""

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install Rust toolchain
      uses: dtolnay/rust-toolchain@stable
      with:
        targets: ${{ matrix.target }}

    - name: Configure Rust cache
      uses: Swatinem/rust-cache@v2
      with:
        key: release-${{ matrix.target }}

    - name: Build release binary
      run: cargo build --release --target ${{ matrix.target }} --package cortesia

    - name: Create artifact directory
      run: mkdir artifacts

    - name: Copy binary (Unix)
      if: matrix.os != 'windows-latest'
      run: |
        cp target/${{ matrix.target }}/release/cortesia${{ matrix.binary_extension }} \
           artifacts/${{ matrix.artifact_name }}${{ matrix.binary_extension }}

    - name: Copy binary (Windows)
      if: matrix.os == 'windows-latest'
      run: |
        Copy-Item target/${{ matrix.target }}/release/cortesia${{ matrix.binary_extension }} `
                  artifacts/${{ matrix.artifact_name }}${{ matrix.binary_extension }}

    - name: Create archive (Unix)
      if: matrix.os != 'windows-latest'
      run: |
        cd artifacts
        tar -czf ${{ matrix.artifact_name }}.tar.gz ${{ matrix.artifact_name }}${{ matrix.binary_extension }}

    - name: Create archive (Windows)
      if: matrix.os == 'windows-latest'
      run: |
        cd artifacts
        Compress-Archive -Path ${{ matrix.artifact_name }}${{ matrix.binary_extension }} -DestinationPath ${{ matrix.artifact_name }}.zip

    - name: Upload artifact (Unix)
      if: matrix.os != 'windows-latest'
      uses: actions/upload-artifact@v3
      with:
        name: ${{ matrix.artifact_name }}
        path: artifacts/${{ matrix.artifact_name }}.tar.gz

    - name: Upload artifact (Windows)
      if: matrix.os == 'windows-latest'
      uses: actions/upload-artifact@v3
      with:
        name: ${{ matrix.artifact_name }}
        path: artifacts/${{ matrix.artifact_name }}.zip

  release:
    name: Create Release
    runs-on: ubuntu-latest
    needs: build
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Download all artifacts
      uses: actions/download-artifact@v3
      with:
        path: artifacts

    - name: Prepare release assets
      run: |
        mkdir release-assets
        find artifacts -name "*.tar.gz" -o -name "*.zip" | while read file; do
          cp "$file" release-assets/
        done
        ls -la release-assets/

    - name: Extract version from tag
      id: version
      run: |
        VERSION=${GITHUB_REF#refs/tags/v}
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "Version: $VERSION"

    - name: Generate release notes
      id: release_notes
      run: |
        echo "release_notes<<EOF" >> $GITHUB_OUTPUT
        echo "# Cortesia Release v${{ steps.version.outputs.version }}" >> $GITHUB_OUTPUT
        echo "" >> $GITHUB_OUTPUT
        echo "## ðŸš€ What's New" >> $GITHUB_OUTPUT
        echo "" >> $GITHUB_OUTPUT
        echo "This release includes improvements to the neuromorphic knowledge graph system." >> $GITHUB_OUTPUT
        echo "" >> $GITHUB_OUTPUT
        echo "## ðŸ“¦ Assets" >> $GITHUB_OUTPUT
        echo "" >> $GITHUB_OUTPUT
        echo "- **Linux x86_64**: \`cortesia-linux-x86_64.tar.gz\`" >> $GITHUB_OUTPUT
        echo "- **Windows x86_64**: \`cortesia-windows-x86_64.zip\`" >> $GITHUB_OUTPUT
        echo "- **macOS x86_64**: \`cortesia-macos-x86_64.tar.gz\`" >> $GITHUB_OUTPUT
        echo "- **macOS ARM64**: \`cortesia-macos-aarch64.tar.gz\`" >> $GITHUB_OUTPUT
        echo "" >> $GITHUB_OUTPUT
        echo "## ðŸ” Verification" >> $GITHUB_OUTPUT
        echo "" >> $GITHUB_OUTPUT
        echo "All binaries are built from commit: \`${{ github.sha }}\`" >> $GITHUB_OUTPUT
        echo "" >> $GITHUB_OUTPUT
        echo "## ðŸ› Issues" >> $GITHUB_OUTPUT
        echo "" >> $GITHUB_OUTPUT
        echo "Please report any issues on our [GitHub Issues page](https://github.com/${{ github.repository }}/issues)." >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT

    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: release-assets/*
        body: ${{ steps.release_notes.outputs.release_notes }}
        draft: false
        prerelease: ${{ contains(github.ref, '-') }}
        generate_release_notes: true
        make_latest: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Announce release
      run: |
        echo "ðŸŽ‰ Release v${{ steps.version.outputs.version }} created successfully!"
        echo "ðŸ“¦ Assets uploaded:"
        ls -la release-assets/
        echo "ðŸ”— Release URL: https://github.com/${{ github.repository }}/releases/tag/v${{ steps.version.outputs.version }}"
```

2. Create release checklist template at .github/ISSUE_TEMPLATE/release_checklist.md:

```markdown
---
name: Release Checklist
about: Checklist for preparing a new release
title: 'Release v[VERSION] Checklist'
labels: ['release', 'checklist']
assignees: ''

---

# Release v[VERSION] Checklist

## Pre-release Preparation

- [ ] All target features implemented and tested
- [ ] All tests passing on main branch
- [ ] Documentation updated for new features
- [ ] Changelog updated with release notes
- [ ] Version number updated in Cargo.toml files
- [ ] Performance benchmarks run and baselines updated
- [ ] Security audit completed (cargo audit)

## Release Process

- [ ] Create release branch: `git checkout -b release/v[VERSION]`
- [ ] Final testing on release branch
- [ ] Merge release branch to main
- [ ] Create and push version tag: `git tag v[VERSION] && git push origin v[VERSION]`
- [ ] Monitor release workflow execution
- [ ] Verify all platform builds complete successfully
- [ ] Test downloaded release artifacts

## Post-release

- [ ] Verify GitHub release created with all assets
- [ ] Test installation instructions with release binaries
- [ ] Update documentation with new release
- [ ] Announce release (if applicable)
- [ ] Monitor for initial bug reports

## Rollback Plan

If issues are discovered:
- [ ] Document the issue
- [ ] Create hotfix branch if needed
- [ ] Consider yanking release if critical
- [ ] Plan next patch release

## Notes

[Add any specific notes for this release]
```

Release automation workflow is now configured with multi-platform builds and GitHub integration.
```

## Success Criteria
- [ ] Automated release workflow operational
- [ ] Multi-platform builds working (Linux, Windows, macOS)
- [ ] Artifact generation and packaging
- [ ] GitHub release creation with assets